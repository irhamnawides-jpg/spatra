 <!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Nilai & Jawaban - Filter Kelas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            min-height: 600px;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            border-bottom: 5px solid #3498db;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }
        
        .header-subtitle {
            font-size: 14px;
            color: #bdc3c7;
            opacity: 0.9;
        }
        
        .connection-status {
            position: absolute;
            top: 25px;
            right: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #27ae60;
            animation: pulse 2s infinite;
        }
        
        .status-dot.offline {
            background-color: #e74c3c;
            animation: none;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .student-info {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 15px;
        }
        
        .info-item {
            flex: 1;
            min-width: 200px;
        }
        
        .info-label {
            font-size: 14px;
            color: #bdc3c7;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .dashboard-content {
            padding: 30px;
            min-height: 500px;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 12px;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .controls-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 992px) {
            .controls-section {
                grid-template-columns: 1fr;
            }
        }
        
        .filter-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
        }
        
        .filter-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-title i {
            color: #3498db;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .filter-select {
            width: 100%;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #bdc3c7;
            font-size: 16px;
            background-color: white;
            color: #2c3e50;
            font-weight: 500;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .filter-results {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        .student-info-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .catatan-box {
            font-style: italic;
            color: #7f8c8d;
            background-color: #e8f4fc;
            padding: 12px 20px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px dashed #3498db;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e5eb;
            margin-bottom: 25px;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab.active {
            color: #3498db;
            background-color: white;
            border-bottom: 3px solid #3498db;
        }
        
        .tab:hover:not(.active) {
            color: #2c3e50;
            background-color: #e9ecef;
        }
        
        .tab-content {
            display: none;
            padding: 20px 0;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            max-height: 500px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        thead {
            background-color: #2c3e50;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            padding: 16px 12px;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid #34495e;
        }
        
        th:last-child {
            border-right: none;
        }
        
        tbody tr {
            border-bottom: 1px solid #e1e5eb;
            transition: background-color 0.2s;
        }
        
        tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        tbody tr:nth-child(even):hover {
            background-color: #f1f3f5;
        }
        
        td {
            padding: 14px 12px;
            text-align: center;
            border-right: 1px solid #e1e5eb;
        }
        
        td:first-child {
            font-weight: 600;
            background-color: #f1f8ff;
            color: #2c3e50;
        }
        
        td:last-child {
            border-right: none;
        }
        
        .score-cell {
            font-weight: 600;
            border-radius: 4px;
        }
        
        .score-high {
            color: #27ae60;
            background-color: rgba(39, 174, 96, 0.1);
        }
        
        .score-medium {
            color: #f39c12;
            background-color: rgba(243, 156, 18, 0.1);
        }
        
        .score-low {
            color: #e74c3c;
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .kelas-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .kelas-xii-ipa-1 {
            background-color: #e8f4fc;
            color: #2980b9;
        }
        
        .kelas-xii-ips-2 {
            background-color: #f9f0ff;
            color: #8e44ad;
        }
        
        .kelas-xii-ipa-2 {
            background-color: #e8f6f3;
            color: #16a085;
        }
        
        .kelas-xii-ips-1 {
            background-color: #fef9e7;
            color: #f39c12;
        }
        
        .kelas-other {
            background-color: #f2f4f4;
            color: #7f8c8d;
        }
        
        .jawaban-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .jawaban-card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-top: 5px solid #3498db;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .jawaban-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .jawaban-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f8ff;
        }
        
        .jawaban-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .jawaban-badge {
            background-color: #3498db;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .aktivitas-list {
            flex-grow: 1;
        }
        
        .aktivitas-item {
            margin-bottom: 16px;
            padding: 14px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: background-color 0.3s;
        }
        
        .aktivitas-item:hover {
            background-color: #e9ecef;
        }
        
        .aktivitas-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
        }
        
        .aktivitas-label i {
            color: #3498db;
            width: 20px;
            text-align: center;
        }
        
        .aktivitas-deskripsi {
            color: #5a6c7d;
            line-height: 1.6;
            font-size: 14.5px;
            padding-left: 30px;
        }
        
        .evaluasi-box {
            background-color: #e8f4fc;
            border-radius: 8px;
            padding: 18px;
            margin-top: 20px;
            border: 1px dashed #3498db;
        }
        
        .evaluasi-label {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }
        
        .evaluasi-label i {
            color: #3498db;
        }
        
        .evaluasi-jawaban {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            letter-spacing: 3px;
            color: #2c3e50;
            padding: 12px;
            background-color: white;
            border-radius: 6px;
            text-align: center;
            font-weight: 700;
            border: 1px solid #bdc3c7;
        }
        
        .summary-cards {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .card {
            flex: 1;
            min-width: 200px;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #3498db;
        }
        
        .card h3 {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .card-2 {
            border-top-color: #2ecc71;
        }
        
        .card-3 {
            border-top-color: #e74c3c;
        }
        
        .card-4 {
            border-top-color: #f39c12;
        }
        
        .bab-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .bab-icon {
            width: 24px;
            height: 24px;
            background-color: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .class-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .class-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-top: 4px solid;
        }
        
        .class-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .class-title {
            font-size: 18px;
            font-weight: 700;
        }
        
        .class-count {
            background-color: #f1f8ff;
            color: #3498db;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .class-stats {
            margin-top: 15px;
        }
        
        .class-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f1f8ff;
        }
        
        .class-stat:last-child {
            border-bottom: none;
        }
        
        .class-stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .class-stat-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .class-students-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 5px;
            background-color: #f8f9fa;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .student-item:hover {
            background-color: #e9ecef;
        }
        
        .student-item.active {
            background-color: #e8f4fc;
            border-left: 3px solid #3498db;
        }
        
        .student-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .student-average {
            font-weight: 700;
            color: #27ae60;
        }
        
        .footer {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #e1e5eb;
        }
        
        .error-message {
            background-color: #fde8e8;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .retry-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        
        .retry-button:hover {
            background-color: #2980b9;
        }
        
        .data-source {
            text-align: center;
            margin-top: 10px;
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .reset-filters {
            background-color: #f8f9fa;
            color: #2c3e50;
            border: 1px solid #bdc3c7;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            margin-top: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .reset-filters:hover {
            background-color: #e9ecef;
            border-color: #3498db;
            color: #3498db;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }
            
            .connection-status {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 15px;
                justify-content: center;
            }
            
            .dashboard-content {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .student-info {
                gap: 15px;
            }
            
            .info-item {
                min-width: 100%;
            }
            
            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .tab {
                padding: 12px 20px;
                font-size: 14px;
                white-space: nowrap;
            }
            
            .jawaban-container {
                grid-template-columns: 1fr;
            }
            
            .catatan-box {
                max-width: 100%;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container" id="dashboard-container">
        <div class="loading-overlay" id="loading-overlay">
            <div class="loader"></div>
            <p>Memuat data dari Google Sheets...</p>
            <p class="data-source">Sumber: https://docs.google.com/spreadsheets/d/1lueDGzRkaXb4XV0wnWlARF3OmkGnhIrP1Eg6fnBghf0</p>
        </div>
        
        <div class="header">
            <h1>DASHBOARD NILAI & JAWABAN SISWA</h1>
            <div class="header-subtitle">Filter Berdasarkan Kelas - Data Terhubung dengan Google Sheets</div>
            <div class="connection-status" id="connection-status">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">Menghubungkan...</span>
            </div>
            
            <div class="student-info">
                <div class="info-item">
                    <div class="info-label">Nama Siswa</div>
                    <div id="nama-siswa" class="info-value">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Kelas</div>
                    <div id="kelas" class="info-value">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Kode Affiliasi</div>
                    <div id="kode-affiliasi" class="info-value">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Status</div>
                    <div id="status-siswa" class="info-value">-</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-content" id="dashboard-content" style="display: none;">
            <div class="controls-section">
                <div class="filter-box">
                    <div class="filter-title">
                        <i class="fas fa-filter"></i> FILTER KELAS
                    </div>
                    
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="filter-kelas">Filter Berdasarkan Kelas:</label>
                            <select id="filter-kelas" class="filter-select">
                                <option value="">Semua Kelas</option>
                                <option value="XII IPA 1">XII IPA 1</option>
                                <option value="XII IPA 2">XII IPA 2</option>
                                <option value="XII IPS 1">XII IPS 1</option>
                                <option value="XII IPS 2">XII IPS 2</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="filter-siswa">Pilih Siswa:</label>
                            <select id="filter-siswa" class="filter-select">
                                <option value="">Pilih Siswa...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-results" id="filter-results">
                        Menampilkan 0 dari 0 siswa
                    </div>
                    
                    <button class="reset-filters" id="reset-filters">
                        <i class="fas fa-redo"></i> Reset Filter
                    </button>
                </div>
                
                <div class="student-info-box">
                    <div class="info-item">
                        <div class="info-label">Informasi Siswa Terpilih</div>
                        <div id="selected-student-info">
                            <div style="margin-bottom: 10px;">
                                <strong>Nama:</strong> <span id="selected-nama">-</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>Kelas:</strong> <span id="selected-kelas">-</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>Kode Affiliasi:</strong> <span id="selected-kode">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="catatan" class="catatan-box">
                        -
                    </div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="nilai">
                    <i class="fas fa-chart-bar"></i> NILAI SISWA
                </button>
                <button class="tab" data-tab="jawaban">
                    <i class="fas fa-file-alt"></i> JAWABAN AKTIVITAS
                </button>
                <button class="tab" data-tab="kelas">
                    <i class="fas fa-users"></i> RINGKASAN KELAS
                </button>
                <button class="tab" data-tab="ringkasan">
                    <i class="fas fa-chart-pie"></i> STATISTIK
                </button>
            </div>
            
            <!-- Tab Nilai -->
            <div id="nilai-tab" class="tab-content active">
                <div id="nilai-error" class="error-message" style="display: none;"></div>
                <div class="table-container">
                    <table id="nilai-table">
                        <thead>
                            <tr>
                                <th>Materi</th>
                                <th>Lit. Gambar</th>
                                <th>Lit. Digital</th>
                                <th>Konsep</th>
                                <th>Deep Learning</th>
                                <th>Refleksi Perilaku</th>
                                <th>Evaluasi</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <p>Pilih siswa untuk melihat data nilai...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-cards">
                    <div class="card">
                        <h3>Rata-rata Keseluruhan</h3>
                        <div id="rata-rata" class="card-value">-</div>
                    </div>
                    <div class="card card-2">
                        <h3>Bab Terbaik</h3>
                        <div id="bab-terbaik" class="card-value">-</div>
                    </div>
                    <div class="card card-3">
                        <h3>Bab Terendah</h3>
                        <div id="bab-terendah" class="card-value">-</div>
                    </div>
                    <div class="card card-4">
                        <h3>Total Nilai</h3>
                        <div id="total-nilai" class="card-value">-</div>
                    </div>
                </div>
            </div>
            
            <!-- Tab Jawaban -->
            <div id="jawaban-tab" class="tab-content">
                <h3 style="color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #3498db;">
                    <i class="fas fa-book-open"></i> JAWABAN AKTIVITAS DAN EVALUASI
                </h3>
                <div id="jawaban-error" class="error-message" style="display: none;"></div>
                <div id="jawaban-container" class="jawaban-container">
                    <div style="text-align: center; padding: 40px; color: #7f8c8d; grid-column: 1 / -1;">
                        <i class="fas fa-user-graduate fa-2x" style="margin-bottom: 15px;"></i>
                        <p>Pilih siswa untuk melihat jawaban...</p>
                    </div>
                </div>
            </div>
            
            <!-- Tab Ringkasan Kelas -->
            <div id="kelas-tab" class="tab-content">
                <h3 style="color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #3498db;">
                    <i class="fas fa-school"></i> RINGKASAN PER KELAS
                </h3>
                <div id="kelas-error" class="error-message" style="display: none;"></div>
                <div id="kelas-container" class="class-summary">
                    <div style="text-align: center; padding: 40px; color: #7f8c8d; grid-column: 1 / -1;">
                        <i class="fas fa-spinner fa-spin fa-2x" style="margin-bottom: 15px;"></i>
                        <p>Memuat ringkasan kelas...</p>
                    </div>
                </div>
            </div>
            
            <!-- Tab Statistik -->
            <div id="ringkasan-tab" class="tab-content">
                <h3 style="color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #3498db;">
                    <i class="fas fa-chart-line"></i> STATISTIK DETAIL
                </h3>
                <div id="ringkasan-error" class="error-message" style="display: none;"></div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;" id="ringkasan-container">
                    <div>
                        <div class="statistik-box" style="background-color: #f8f9fa; padding: 25px; border-radius: 10px; border: 1px solid #e1e5eb;">
                            <h4 style="color: #2c3e50; margin-bottom: 20px; font-size: 18px;">Statistik Detail</h4>
                            <div id="statistik-detail">
                                <p>Pilih siswa untuk melihat statistik...</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="chart-container" style="background-color: white; padding: 25px; border-radius: 10px; border: 1px solid #e1e5eb; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h4 style="color: #2c3e50; margin-bottom: 20px; font-size: 18px;">Distribusi Nilai per Bab</h4>
                            <div id="chart-placeholder" style="text-align: center; padding: 40px;">
                                <p>Grafik akan ditampilkan setelah data dimuat...</p>
                            </div>
                            <canvas id="nilai-chart" width="400" height="300" style="max-width: 100%; display: none;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <i class="fas fa-graduation-cap"></i> Dashboard Nilai & Jawaban Siswa Â© 2024 - Sistem Filter Kelas
        </div>
    </div>

    <script>
        // Konfigurasi Google Sheets
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1lueDGzRkaXb4XV0wnWlARF3OmkGnhIrP1Eg6fnBghf0';
        const SHEET_ID = '0';
        
        // Data fallback dengan lebih banyak variasi kelas
        const FALLBACK_DATA = [
            {
                "USER": "student01",
                "PASSWORD": "pass123",
                "KODE_AFFILIASI": "AFF-2024-001",
                "NAMA_LENGKAP": "Budi Santoso",
                "KELAS": "XII IPA 1",
                "CATATAN": "Siswa berprestasi tahun 2024",
                "NILAI_BAB1": "85#78#92#88#90#86",
                "NILAI_BAB2": "76#89#94#81#85#92",
                "NILAI_BAB3": "88#92#79#85#90#87",
                "NILAI_BAB4": "91#84#86#89#93#88",
                "NILAI_BAB5": "82#90#87#84#91#89",
                "JAWABAN_BAB1": "JWB AK1: Membuat mind map konsep dasar#JWB AK2: Menganalisis 5 kasus studi#JWB AK3: Presentasi kelompok tentang literasi digital#JWB AK4: Simulasi penggunaan tool AI#JWB AK5: Refleksi pembelajaran mandiri#Evaluasi: ABCDABDAAA",
                "JAWABAN_BAB2": "JWB AK1: Studi literatur 10 jurnal#JWB AK2: Analisis perbandingan tools#JWB AK3: Pembuatan infografis digital#JWB AK4: Diskusi panel online#JWB AK5: Portofolio mingguan#Evaluasi: BCADCBADAB",
                "JAWABAN_BAB3": "JWB AK1: Eksperimen lab virtual#JWB AK2: Case study analysis#JWB AK3: Peer review assignment#JWB AK4: Video tutorial creation#JWB AK5: Learning journal#Evaluasi: DABCCDABBA",
                "JAWABAN_BAB4": "JWB AK1: Research proposal#JWB AK2: Data collection project#JWB AK3: Statistical analysis#JWB AK4: Presentation skills#JWB AK5: Critical reflection#Evaluasi: CDBAABCDAB",
                "JAWABAN_BAB5": "JWB AK1: Final project design#JWB AK2: Implementation phase#JWB AK3: Testing and validation#JWB AK4: Documentation#JWB AK5: Final presentation#Evaluasi: ABCDDCBAAB"
            },
            {
                "USER": "student02",
                "PASSWORD": "secure456",
                "KODE_AFFILIASI": "AFF-2024-002",
                "NAMA_LENGKAP": "Siti Nurhaliza",
                "KELAS": "XII IPS 2",
                "CATATAN": "Aktif dalam organisasi",
                "NILAI_BAB1": "78#85#90#82#88#84",
                "NILAI_BAB2": "85#92#76#89#81#90",
                "NILAI_BAB3": "90#83#88#85#92#79",
                "NILAI_BAB4": "84#89#91#86#88#93",
                "NILAI_BAB5": "87#84#90#92#85#91",
                "JAWABAN_BAB1": "JWB AK1: Membuat peta konsep interaktif#JWB AK2: Analisis 3 studi kasus utama#JWB AK3: Presentasi literasi media#JWB AK4: Workshop penggunaan aplikasi#JWB AK5: Jurnal refleksi mingguan#Evaluasi: BACDABCDAA",
                "JAWABAN_BAB2": "JWB AK1: Review 8 artikel ilmiah#JWB AK2: Comparative analysis tools#JWB AK3: Digital poster creation#JWB AK4: Online forum discussion#JWB AK5: Weekly progress report#Evaluasi: CBADDCBABA",
                "JAWABAN_BAB3": "JWB AK1: Virtual simulation lab#JWB AK2: Detailed case analysis#JWB AK3: Cross-peer evaluation#JWB AK4: Instructional video#JWB AK5: Reflective learning log#Evaluasi: DABCABCDAB",
                "JAWABAN_BAB4": "JWB AK1: Mini research project#JWB AK2: Field data gathering#JWB AK3: Data interpretation#JWB AK4: Public speaking drill#JWB AK5: Self-assessment essay#Evaluasi: BCDAABCDBA",
                "JAWABAN_BAB5": "JWB AK1: Capstone project plan#JWB AK2: Project execution#JWB AK3: Quality assessment#JWB AK4: Project report#JWB AK5: Final defense#Evaluasi: ABDCCDABBA"
            },
            {
                "USER": "student03",
                "PASSWORD": "pass789",
                "KODE_AFFILIASI": "AFF-2024-003",
                "NAMA_LENGKAP": "Ahmad Fauzi",
                "KELAS": "XII IPA 1",
                "CATATAN": "Siswa dengan perkembangan pesat",
                "NILAI_BAB1": "82#75#88#79#85#81",
                "NILAI_BAB2": "78#85#90#82#88#84",
                "NILAI_BAB3": "85#88#79#83#90#86",
                "NILAI_BAB4": "88#82#85#90#87#84",
                "NILAI_BAB5": "90#85#88#92#86#89",
                "JAWABAN_BAB1": "JWB AK1: Membuat diagram alir#JWB AK2: Studi kasus implementasi#JWB AK3: Diskusi kelompok#JWB AK4: Praktik tool digital#JWB AK5: Jurnal pembelajaran#Evaluasi: ABDCABCDAA",
                "JAWABAN_BAB2": "JWB AK1: Analisis artikel jurnal#JWB AK2: Perbandingan metode#JWB AK3: Presentasi digital#JWB AK4: Forum diskusi#JWB AK5: Laporan kemajuan#Evaluasi: BCDAABCDAB",
                "JAWABAN_BAB3": "JWB AK1: Simulasi praktikum#JWB AK2: Analisis studi kasus#JWB AK3: Review teman sebaya#JWB AK4: Video demonstrasi#JWB AK5: Catatan belajar#Evaluasi: CDABABCDAB",
                "JAWABAN_BAB4": "JWB AK1: Proposal penelitian#JWB AK2: Pengumpulan data#JWB AK3: Analisis statistik#JWB AK4: Keterampilan presentasi#JWB AK5: Refleksi kritis#Evaluasi: DABCABCDAB",
                "JAWABAN_BAB5": "JWB AK1: Desain proyek akhir#JWB AK2: Pelaksanaan proyek#JWB AK3: Uji validasi#JWB AK4: Dokumentasi akhir#JWB AK5: Presentasi akhir#Evaluasi: ABCDDCBAAB"
            },
            {
                "USER": "student04",
                "PASSWORD": "secure789",
                "KODE_AFFILIASI": "AFF-2024-004",
                "NAMA_LENGKAP": "Dewi Lestari",
                "KELAS": "XII IPS 2",
                "CATATAN": "Siswa aktif berorganisasi",
                "NILAI_BAB1": "75#82#88#79#85#80",
                "NILAI_BAB2": "82#88#75#85#79#90",
                "NILAI_BAB3": "88#79#85#90#82#87",
                "NILAI_BAB4": "85#90#88#82#87#92",
                "NILAI_BAB5": "92#85#90#88#84#89",
                "JAWABAN_BAB1": "JWB AK1: Peta konsep visual#JWB AK2: Studi kasus sosial#JWB AK3: Presentasi multimedia#JWB AK4: Workshop digital#JWB AK5: Refleksi mingguan#Evaluasi: BACDABCDAA",
                "JAWABAN_BAB2": "JWB AK1: Review literatur#JWB AK2: Analisis komparatif#JWB AK3: Poster digital#JWB AK4: Diskusi online#JWB AK5: Laporan perkembangan#Evaluasi: CBADDCBABA",
                "JAWABAN_BAB3": "JWB AK1: Simulasi virtual#JWB AK2: Analisis mendalam#JWB AK3: Evaluasi sejawat#JWB AK4: Video pembelajaran#JWB AK5: Log pembelajaran#Evaluasi: DABCABCDAB",
                "JAWABAN_BAB4": "JWB AK1: Proyek riset kecil#JWB AK2: Pengambilan data#JWB AK3: Interpretasi data#JWB AK4: Latihan public speaking#JWB AK5: Esai evaluasi diri#Evaluasi: BCDAABCDBA",
                "JAWABAN_BAB5": "JWB AK1: Rencana proyek capstone#JWB AK2: Eksekusi proyek#JWB AK3: Penilaian kualitas#JWB AK4: Laporan proyek#JWB AK5: Pertahanan akhir#Evaluasi: ABDCCDABBA"
            },
            {
                "USER": "student05",
                "PASSWORD": "pass555",
                "KODE_AFFILIASI": "AFF-2024-005",
                "NAMA_LENGKAP": "Rizki Pratama",
                "KELAS": "XII IPA 2",
                "CATATAN": "Siswa dengan bakat teknologi",
                "NILAI_BAB1": "88#92#85#90#87#89",
                "NILAI_BAB2": "90#85#92#88#86#91",
                "NILAI_BAB3": "92#88#90#87#89#93",
                "NILAI_BAB4": "89#93#88#92#90#94",
                "NILAI_BAB5": "94#90#92#89#91#95",
                "JAWABAN_BAB1": "JWB AK1: Mind map digital#JWB AK2: Analisis studi kasus teknis#JWB AK3: Presentasi teknologi#JWB AK4: Workshop AI tools#JWB AK5: Refleksi digital#Evaluasi: ABCDABDAAA",
                "JAWABAN_BAB2": "JWB AK1: Studi jurnal teknologi#JWB AK2: Analisis tools canggih#JWB AK3: Infografis interaktif#JWB AK4: Forum teknologi#JWB AK5: Portofolio digital#Evaluasi: BCADCBADAB",
                "JAWABAN_BAB3": "JWB AK1: Lab virtual lanjutan#JWB AK2: Case study kompleks#JWB AK3: Peer review teknis#JWB AK4: Tutorial video lanjutan#JWB AK5: Journal teknologi#Evaluasi: DABCCDABBA",
                "JAWABAN_BAB4": "JWB AK1: Proposal riset teknologi#JWB AK2: Pengumpulan data teknis#JWB AK3: Analisis data kompleks#JWB AK4: Presentasi teknis#JWB AK5: Refleksi kritis teknologi#Evaluasi: CDBAABCDAB",
                "JAWABAN_BAB5": "JWB AK1: Desain proyek final teknologi#JWB AK2: Implementasi sistem#JWB AK3: Testing dan debugging#JWB AK4: Dokumentasi teknis#JWB AK5: Presentasi final produk#Evaluasi: ABCDDCBAAB"
            }
        ];

        // Variabel global
        let allStudentsData = [];
        let filteredStudentsData = [];
        let currentStudentIndex = -1;
        let currentKelasFilter = '';
        let isOnline = false;

        // Fungsi untuk mengambil data dari Google Sheets
        async function fetchDataFromGoogleSheets() {
            try {
                const url = `${GOOGLE_SHEETS_URL}/gviz/tq?tqx=out:json&gid=${SHEET_ID}`;
                
                console.log('Mengambil data dari:', url);
                
                const response = await fetch(url, {
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                const jsonString = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]+)\);/)[1];
                const data = JSON.parse(jsonString);
                
                return convertGoogleSheetsData(data);
                
            } catch (error) {
                console.error('Error mengambil data dari Google Sheets:', error);
                console.log('Menggunakan data fallback...');
                return FALLBACK_DATA;
            }
        }

        // Fungsi untuk mengonversi data Google Sheets ke format kita
        function convertGoogleSheetsData(googleData) {
            if (!googleData || !googleData.table || !googleData.table.rows) {
                return FALLBACK_DATA;
            }
            
            const rows = googleData.table.rows;
            const students = [];
            
            rows.forEach((row, rowIndex) => {
                if (rowIndex === 0 && row.c[0] && row.c[0].v === 'USER') {
                    return;
                }
                
                const student = {};
                
                const columnMapping = [
                    'USER', 'PASSWORD', 'KODE_AFFILIASI', 'NAMA_LENGKAP', 'KELAS', 'CATATAN',
                    'NILAI_BAB1', 'NILAI_BAB2', 'NILAI_BAB3', 'NILAI_BAB4', 'NILAI_BAB5',
                    'JAWABAN_BAB1', 'JAWABAN_BAB2', 'JAWABAN_BAB3', 'JAWABAN_BAB4', 'JAWABAN_BAB5'
                ];
                
                columnMapping.forEach((colName, colIndex) => {
                    if (row.c[colIndex] && row.c[colIndex].v !== undefined) {
                        student[colName] = String(row.c[colIndex].v);
                    } else {
                        const fallbackStudent = FALLBACK_DATA[rowIndex] || FALLBACK_DATA[0];
                        student[colName] = fallbackStudent[colName] || '';
                    }
                });
                
                students.push(student);
            });
            
            return students.length > 0 ? students : FALLBACK_DATA;
        }

        // Fungsi untuk memparsing data nilai
        function parseNilaiData(nilaiString) {
            const nilaiArray = nilaiString.split('#').map(n => parseInt(n.trim()));
            
            if (nilaiArray.length === 6) {
                return nilaiArray;
            }
            
            return [0, 0, 0, 0, 0, 0];
        }

        // Fungsi untuk memparsing data jawaban
        function parseJawabanData(jawabanString) {
            const parts = jawabanString.split('#');
            
            const aktivitas = [];
            let evaluasi = '';
            
            parts.forEach(part => {
                if (part.includes('Evaluasi:')) {
                    evaluasi = part.replace('Evaluasi:', '').trim();
                } else if (part.includes('JWB AK')) {
                    const cleaned = part.replace(/JWB AK\d+:/, '').trim();
                    aktivitas.push(cleaned);
                }
            });
            
            while (aktivitas.length < 5) {
                aktivitas.push('-');
            }
            
            return { aktivitas, evaluasi };
        }

        // Fungsi untuk menghitung statistik siswa
        function calculateStatistics(studentData) {
            const nilaiData = [];
            
            for (let i = 1; i <= 5; i++) {
                const nilaiKey = `NILAI_BAB${i}`;
                if (studentData[nilaiKey]) {
                    const nilaiArray = parseNilaiData(studentData[nilaiKey]);
                    nilaiData.push({
                        bab: i,
                        nilai: nilaiArray
                    });
                }
            }
            
            let totalAll = 0;
            let countAll = 0;
            const babAverages = [];
            
            nilaiData.forEach(bab => {
                const babTotal = bab.nilai.reduce((sum, nilai) => sum + nilai, 0);
                const babAverage = babTotal / bab.nilai.length;
                
                babAverages.push({
                    bab: bab.bab,
                    average: babAverage
                });
                
                totalAll += babTotal;
                countAll += bab.nilai.length;
            });
            
            const overallAverage = countAll > 0 ? totalAll / countAll : 0;
            
            let bestBab = { bab: 0, average: 0 };
            let worstBab = { bab: 0, average: 100 };
            
            if (babAverages.length > 0) {
                bestBab = babAverages.reduce((max, bab) => bab.average > max.average ? bab : max);
                worstBab = babAverages.reduce((min, bab) => bab.average < min.average ? bab : min);
            }
            
            let allNilai = [];
            nilaiData.forEach(bab => {
                allNilai = allNilai.concat(bab.nilai);
            });
            
            const nilaiTertinggi = allNilai.length > 0 ? Math.max(...allNilai) : 0;
            const nilaiTerendah = allNilai.length > 0 ? Math.min(...allNilai) : 0;
            const nilaiDiatas85 = allNilai.filter(n => n >= 85).length;
            const persenDiatas85 = allNilai.length > 0 ? (nilaiDiatas85 / allNilai.length * 100).toFixed(1) : 0;
            
            return {
                overallAverage,
                bestBab,
                worstBab,
                totalAll,
                nilaiTertinggi,
                nilaiTerendah,
                babAverages,
                jumlahNilai: allNilai.length,
                nilaiDiatas85,
                persenDiatas85
            };
        }

        // Fungsi untuk menghitung statistik kelas
        function calculateClassStatistics(kelasData) {
            if (kelasData.length === 0) {
                return {
                    jumlahSiswa: 0,
                    rataRataKelas: 0,
                    nilaiTertinggiKelas: 0,
                    nilaiTerendahKelas: 0,
                    siswaTerbaik: null,
                    siswaPerkembangan: null
                };
            }
            
            let totalNilaiKelas = 0;
            let totalNilaiCount = 0;
            let nilaiTertinggiKelas = 0;
            let nilaiTerendahKelas = 100;
            let siswaTerbaik = null;
            let siswaTerbaikAvg = 0;
            
            kelasData.forEach(student => {
                const stats = calculateStatistics(student);
                
                totalNilaiKelas += stats.totalAll;
                totalNilaiCount += stats.jumlahNilai;
                
                if (stats.nilaiTertinggi > nilaiTertinggiKelas) {
                    nilaiTertinggiKelas = stats.nilaiTertinggi;
                }
                
                if (stats.nilaiTerendah < nilaiTerendahKelas) {
                    nilaiTerendahKelas = stats.nilaiTerendah;
                }
                
                if (stats.overallAverage > siswaTerbaikAvg) {
                    siswaTerbaikAvg = stats.overallAverage;
                    siswaTerbaik = student;
                }
            });
            
            const rataRataKelas = totalNilaiCount > 0 ? (totalNilaiKelas / totalNilaiCount) : 0;
            
            // Cari siswa dengan perkembangan terbaik (selisih nilai terbesar antara bab 5 dan bab 1)
            let siswaPerkembangan = null;
            let perkembanganTerbesar = 0;
            
            kelasData.forEach(student => {
                const nilaiBab1 = parseNilaiData(student.NILAI_BAB1 || "0#0#0#0#0#0");
                const nilaiBab5 = parseNilaiData(student.NILAI_BAB5 || "0#0#0#0#0#0");
                
                const avgBab1 = nilaiBab1.reduce((a, b) => a + b, 0) / nilaiBab1.length;
                const avgBab5 = nilaiBab5.reduce((a, b) => a + b, 0) / nilaiBab5.length;
                
                const perkembangan = avgBab5 - avgBab1;
                
                if (perkembangan > perkembanganTerbesar) {
                    perkembanganTerbesar = perkembangan;
                    siswaPerkembangan = student;
                }
            });
            
            return {
                jumlahSiswa: kelasData.length,
                rataRataKelas: rataRataKelas,
                nilaiTertinggiKelas: nilaiTertinggiKelas,
                nilaiTerendahKelas: nilaiTerendahKelas,
                siswaTerbaik: siswaTerbaik,
                siswaPerkembangan: siswaPerkembangan,
                perkembanganTerbesar: perkembanganTerbesar
            };
        }

        // Fungsi untuk mendapatkan semua kelas unik
        function getAllUniqueClasses(studentsData) {
            const classes = new Set();
            studentsData.forEach(student => {
                if (student.KELAS && student.KELAS.trim()) {
                    classes.add(student.KELAS.trim());
                }
            });
            return Array.from(classes).sort();
        }

        // Fungsi untuk filter data berdasarkan kelas
        function filterDataByClass(studentsData, className) {
            if (!className || className === '') {
                return studentsData;
            }
            return studentsData.filter(student => 
                student.KELAS && student.KELAS.trim() === className
            );
        }

        // Fungsi untuk mengisi dropdown filter
        function populateFilterDropdowns(studentsData) {
            const kelasSelect = document.getElementById('filter-kelas');
            const siswaSelect = document.getElementById('filter-siswa');
            
            // Isi dropdown kelas
            const uniqueClasses = getAllUniqueClasses(studentsData);
            kelasSelect.innerHTML = '<option value="">Semua Kelas</option>';
            
            uniqueClasses.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                kelasSelect.appendChild(option);
            });
            
            // Event listener untuk filter kelas
            kelasSelect.addEventListener('change', function() {
                currentKelasFilter = this.value;
                applyFilters();
            });
            
            // Event listener untuk filter siswa
            siswaSelect.addEventListener('change', function() {
                const selectedIndex = parseInt(this.value);
                if (!isNaN(selectedIndex) && selectedIndex >= 0) {
                    displayStudentData(selectedIndex);
                }
            });
            
            // Reset filters button
            document.getElementById('reset-filters').addEventListener('click', function() {
                resetFilters();
            });
        }

        // Fungsi untuk mengisi dropdown siswa berdasarkan filter
        function populateStudentDropdown() {
            const siswaSelect = document.getElementById('filter-siswa');
            siswaSelect.innerHTML = '<option value="">Pilih Siswa...</option>';
            
            if (filteredStudentsData.length === 0) {
                return;
            }
            
            filteredStudentsData.forEach((student, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${student.NAMA_LENGKAP} - ${student.KELAS}`;
                siswaSelect.appendChild(option);
            });
            
            // Update filter results
            const totalStudents = allStudentsData.length;
            const filteredCount = filteredStudentsData.length;
            document.getElementById('filter-results').textContent = 
                `Menampilkan ${filteredCount} dari ${totalStudents} siswa`;
            
            // Jika ada siswa, pilih yang pertama
            if (filteredStudentsData.length > 0) {
                siswaSelect.value = '0';
                displayStudentData(0);
            } else {
                clearStudentDisplay();
            }
        }

        // Fungsi untuk menerapkan filter
        function applyFilters() {
            filteredStudentsData = filterDataByClass(allStudentsData, currentKelasFilter);
            populateStudentDropdown();
            displayClassSummary();
        }

        // Fungsi untuk reset filter
        function resetFilters() {
            currentKelasFilter = '';
            document.getElementById('filter-kelas').value = '';
            applyFilters();
        }

        // Fungsi untuk menampilkan data siswa
        function displayStudentData(studentIndex) {
            if (!filteredStudentsData || filteredStudentsData.length === 0 || studentIndex < 0) {
                clearStudentDisplay();
                return;
            }
            
            currentStudentIndex = studentIndex;
            const studentData = filteredStudentsData[studentIndex];
            
            // Update header
            document.getElementById('nama-siswa').textContent = studentData.NAMA_LENGKAP || '-';
            document.getElementById('kelas').textContent = studentData.KELAS || '-';
            document.getElementById('kode-affiliasi').textContent = studentData.KODE_AFFILIASI || '-';
            document.getElementById('status-siswa').textContent = 'Aktif';
            
            // Update info box
            document.getElementById('selected-nama').textContent = studentData.NAMA_LENGKAP || '-';
            document.getElementById('selected-kelas').textContent = studentData.KELAS || '-';
            document.getElementById('selected-kode').textContent = studentData.KODE_AFFILIASI || '-';
            document.getElementById('catatan').textContent = studentData.CATATAN || '-';
            
            // Update filter siswa dropdown
            document.getElementById('filter-siswa').value = studentIndex;
            
            // Tampilkan data
            displayNilaiData(studentData);
            displayJawabanData(studentData);
            displayStatistikData(studentData);
        }

        // Fungsi untuk mengosongkan tampilan siswa
        function clearStudentDisplay() {
            document.getElementById('nama-siswa').textContent = '-';
            document.getElementById('kelas').textContent = '-';
            document.getElementById('kode-affiliasi').textContent = '-';
            document.getElementById('status-siswa').textContent = '-';
            
            document.getElementById('selected-nama').textContent = '-';
            document.getElementById('selected-kelas').textContent = '-';
            document.getElementById('selected-kode').textContent = '-';
            document.getElementById('catatan').textContent = '-';
            
            document.getElementById('table-body').innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <p>Tidak ada siswa yang dipilih</p>
                    </td>
                </tr>
            `;
            
            document.getElementById('rata-rata').textContent = '-';
            document.getElementById('bab-terbaik').textContent = '-';
            document.getElementById('bab-terendah').textContent = '-';
            document.getElementById('total-nilai').textContent = '-';
            
            document.getElementById('jawaban-container').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #7f8c8d; grid-column: 1 / -1;">
                    <i class="fas fa-user-graduate fa-2x" style="margin-bottom: 15px;"></i>
                    <p>Tidak ada siswa yang dipilih</p>
                </div>
            `;
            
            document.getElementById('statistik-detail').innerHTML = `<p>Tidak ada data statistik</p>`;
        }

        // Fungsi untuk menampilkan data nilai
        function displayNilaiData(studentData) {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';
            
            const stats = calculateStatistics(studentData);
            
            // Update statistik cards
            document.getElementById('rata-rata').textContent = stats.overallAverage.toFixed(1);
            document.getElementById('bab-terbaik').textContent = stats.bestBab.bab > 0 ? 
                `Bab ${stats.bestBab.bab} (${stats.bestBab.average.toFixed(1)})` : '-';
            document.getElementById('bab-terendah').textContent = stats.worstBab.bab > 0 ? 
                `Bab ${stats.worstBab.bab} (${stats.worstBab.average.toFixed(1)})` : '-';
            document.getElementById('total-nilai').textContent = stats.totalAll;
            
            // Tampilkan nilai per bab
            for (let bab = 1; bab <= 5; bab++) {
                const nilaiKey = `NILAI_BAB${bab}`;
                const nilaiString = studentData[nilaiKey];
                
                if (nilaiString) {
                    const nilaiArray = parseNilaiData(nilaiString);
                    
                    const row = document.createElement('tr');
                    
                    // Kolom bab
                    const babCell = document.createElement('td');
                    babCell.innerHTML = `<div class="bab-header"><div class="bab-icon">${bab}</div><span>BAB ${bab}</span></div>`;
                    row.appendChild(babCell);
                    
                    // Kolom nilai
                    nilaiArray.forEach(nilai => {
                        const nilaiCell = document.createElement('td');
                        nilaiCell.textContent = nilai;
                        nilaiCell.classList.add('score-cell');
                        
                        if (nilai >= 85) {
                            nilaiCell.classList.add('score-high');
                        } else if (nilai >= 75) {
                            nilaiCell.classList.add('score-medium');
                        } else {
                            nilaiCell.classList.add('score-low');
                        }
                        
                        row.appendChild(nilaiCell);
                    });
                    
                    tableBody.appendChild(row);
                }
            }
            
            if (tableBody.children.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #7f8c8d;">
                            <i class="fas fa-exclamation-circle"></i> Tidak ada data nilai
                        </td>
                    </tr>
                `;
            }
        }

        // Fungsi untuk menampilkan data jawaban
        function displayJawabanData(studentData) {
            const jawabanContainer = document.getElementById('jawaban-container');
            jawabanContainer.innerHTML = '';
            
            for (let bab = 1; bab <= 5; bab++) {
                const jawabanKey = `JAWABAN_BAB${bab}`;
                const jawabanString = studentData[jawabanKey];
                
                if (jawabanString) {
                    const { aktivitas, evaluasi } = parseJawabanData(jawabanString);
                    
                    let aktivitasHTML = '';
                    aktivitas.forEach((desc, index) => {
                        aktivitasHTML += `
                            <div class="aktivitas-item">
                                <div class="aktivitas-label">
                                    <i class="fas fa-check-circle"></i>
                                    Aktivitas ${index + 1}
                                </div>
                                <div class="aktivitas-deskripsi">${desc}</div>
                            </div>
                        `;
                    });
                    
                    const card = document.createElement('div');
                    card.className = 'jawaban-card';
                    card.innerHTML = `
                        <div class="jawaban-header">
                            <div class="jawaban-title">BAB ${bab}</div>
                            <div class="jawaban-badge">${aktivitas.length} Aktivitas</div>
                        </div>
                        
                        <div class="aktivitas-list">
                            ${aktivitasHTML}
                        </div>
                        
                        <div class="evaluasi-box">
                            <div class="evaluasi-label">
                                <i class="fas fa-clipboard-check"></i>
                                Jawaban Evaluasi
                            </div>
                            <div class="evaluasi-jawaban">${evaluasi || '-'}</div>
                        </div>
                    `;
                    
                    jawabanContainer.appendChild(card);
                }
            }
            
            if (jawabanContainer.children.length === 0) {
                jawabanContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #7f8c8d; grid-column: 1 / -1;">
                        <i class="fas fa-exclamation-circle fa-2x" style="margin-bottom: 15px;"></i>
                        <p>Tidak ada data jawaban</p>
                    </div>
                `;
            }
        }

        // Fungsi untuk menampilkan statistik data
        function displayStatistikData(studentData) {
            const stats = calculateStatistics(studentData);
            const statistikDiv = document.getElementById('statistik-detail');
            
            const statistikHTML = `
                <div class="statistik-item" style="margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #e1e5eb;">
                    <div class="statistik-label" style="font-size: 14px; color: #7f8c8d; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-line"></i> Nilai Tertinggi
                    </div>
                    <div class="statistik-value" style="font-size: 22px; font-weight: 700; color: ${stats.nilaiTertinggi >= 85 ? '#27ae60' : stats.nilaiTertinggi >= 75 ? '#f39c12' : '#e74c3c'};">${stats.nilaiTertinggi}</div>
                </div>
                
                <div class="statistik-item" style="margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #e1e5eb;">
                    <div class="statistik-label" style="font-size: 14px; color: #7f8c8d; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-line"></i> Nilai Terendah
                    </div>
                    <div class="statistik-value" style="font-size: 22px; font-weight: 700; color: ${stats.nilaiTerendah >= 85 ? '#27ae60' : stats.nilaiTerendah >= 75 ? '#f39c12' : '#e74c3c'};">${stats.nilaiTerendah}</div>
                </div>
                
                <div class="statistik-item" style="margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #e1e5eb;">
                    <div class="statistik-label" style="font-size: 14px; color: #7f8c8d; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-star"></i> Nilai â¥ 85
                    </div>
                    <div class="statistik-value" style="font-size: 22px; font-weight: 700; color: #3498db;">
                        ${stats.nilaiDiatas85} (${stats.persenDiatas85}%)
                    </div>
                </div>
                
                <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #e1e5eb;">
                    <div style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">
                        Rata-rata per Bab
                    </div>
                    ${stats.babAverages.map(item => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 6px;">
                            <span style="font-weight: 600; color: #2c3e50;">Bab ${item.bab}</span>
                            <span style="color: ${item.average >= 85 ? '#27ae60' : item.average >= 75 ? '#f39c12' : '#e74c3c'}; font-weight: 700;">
                                ${item.average.toFixed(1)}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            statistikDiv.innerHTML = statistikHTML;
            
            // Update chart jika tersedia
            if (window.Chart && stats.babAverages.length > 0) {
                updateChart(stats.babAverages);
            }
        }

        // Fungsi untuk menampilkan ringkasan kelas
        function displayClassSummary() {
            const kelasContainer = document.getElementById('kelas-container');
            const uniqueClasses = getAllUniqueClasses(allStudentsData);
            
            if (uniqueClasses.length === 0) {
                kelasContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #7f8c8d; grid-column: 1 / -1;">
                        <i class="fas fa-exclamation-circle fa-2x" style="margin-bottom: 15px;"></i>
                        <p>Tidak ada data kelas</p>
                    </div>
                `;
                return;
            }
            
            let kelasHTML = '';
            
            uniqueClasses.forEach(className => {
                const kelasData = filterDataByClass(allStudentsData, className);
                const classStats = calculateClassStatistics(kelasData);
                
                // Tentukan warna border berdasarkan kelas
                let borderColor = '#3498db'; // default
                if (className.includes('IPA 1')) borderColor = '#2980b9';
                if (className.includes('IPA 2')) borderColor = '#16a085';
                if (className.includes('IPS 1')) borderColor = '#f39c12';
                if (className.includes('IPS 2')) borderColor = '#8e44ad';
                
                // List siswa dalam kelas
                let studentsListHTML = '';
                kelasData.forEach((student, index) => {
                    const studentStats = calculateStatistics(student);
                    const isActive = filteredStudentsData[currentStudentIndex] && 
                                    filteredStudentsData[currentStudentIndex].USER === student.USER;
                    
                    studentsListHTML += `
                        <div class="student-item ${isActive ? 'active' : ''}" 
                             onclick="selectStudentFromClass('${student.USER}')"
                             style="cursor: pointer;">
                            <div class="student-name">${student.NAMA_LENGKAP}</div>
                            <div class="student-average">${studentStats.overallAverage.toFixed(1)}</div>
                        </div>
                    `;
                });
                
                kelasHTML += `
                    <div class="class-card" style="border-top-color: ${borderColor};">
                        <div class="class-card-header">
                            <div class="class-title">${className}</div>
                            <div class="class-count">${classStats.jumlahSiswa} Siswa</div>
                        </div>
                        
                        <div class="class-stats">
                            <div class="class-stat">
                                <span class="class-stat-label">Rata-rata Kelas:</span>
                                <span class="class-stat-value">${classStats.rataRataKelas.toFixed(1)}</span>
                            </div>
                            <div class="class-stat">
                                <span class="class-stat-label">Nilai Tertinggi:</span>
                                <span class="class-stat-value">${classStats.nilaiTertinggiKelas}</span>
                            </div>
                            <div class="class-stat">
                                <span class="class-stat-label">Nilai Terendah:</span>
                                <span class="class-stat-value">${classStats.nilaiTerendahKelas}</span>
                            </div>
                            <div class="class-stat">
                                <span class="class-stat-label">Siswa Terbaik:</span>
                                <span class="class-stat-value">${classStats.siswaTerbaik ? classStats.siswaTerbaik.NAMA_LENGKAP : '-'}</span>
                            </div>
                        </div>
                        
                        <div class="class-students-list">
                            ${studentsListHTML}
                        </div>
                    </div>
                `;
            });
            
            kelasContainer.innerHTML = kelasHTML;
        }

        // Fungsi untuk memilih siswa dari ringkasan kelas
        function selectStudentFromClass(userId) {
            const index = filteredStudentsData.findIndex(student => student.USER === userId);
            if (index >= 0) {
                currentStudentIndex = index;
                displayStudentData(index);
                document.getElementById('filter-siswa').value = index;
            }
        }

        // Fungsi untuk update chart
        function updateChart(babAverages) {
            const canvas = document.getElementById('nilai-chart');
            const placeholder = document.getElementById('chart-placeholder');
            
            if (!canvas) return;
            
            canvas.style.display = 'block';
            if (placeholder) placeholder.style.display = 'none';
            
            const ctx = canvas.getContext('2d');
            
            if (window.myChart) {
                window.myChart.destroy();
            }
            
            const labels = babAverages.map(item => `Bab ${item.bab}`);
            const data = babAverages.map(item => item.average);
            const colors = data.map(avg => {
                if (avg >= 85) return '#27ae60';
                if (avg >= 75) return '#f39c12';
                return '#e74c3c';
            });
            
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Rata-rata Nilai',
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.8', '1')),
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Nilai Rata-rata'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Materi Bab'
                            }
                        }
                    }
                }
            });
        }

        // Fungsi untuk memperbarui status koneksi
        function updateConnectionStatus(connected, message) {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            isOnline = connected;
            
            if (connected) {
                statusDot.className = 'status-dot';
                statusText.textContent = message || 'Terhubung ke Google Sheets';
            } else {
                statusDot.className = 'status-dot offline';
                statusText.textContent = message || 'Menggunakan data lokal';
            }
        }

        // Setup tabs
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    document.querySelectorAll('.tab-content').forEach(c => {
                        c.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    const tabId = this.getAttribute('data-tab');
                    const tabContent = document.getElementById(`${tabId}-tab`);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
        }

        // Load Chart.js
        function loadChartJS() {
            if (typeof Chart === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = function() {
                    console.log('Chart.js loaded');
                };
                document.head.appendChild(script);
            }
        }

        // Fungsi utama untuk memuat data
        async function loadData() {
            try {
                document.getElementById('loading-overlay').style.display = 'flex';
                document.getElementById('dashboard-content').style.display = 'none';
                
                console.log('Memulai pengambilan data dari Google Sheets...');
                allStudentsData = await fetchDataFromGoogleSheets();
                
                console.log('Data berhasil diambil:', allStudentsData.length, 'siswa');
                
                const isFromGoogleSheets = allStudentsData !== FALLBACK_DATA;
                updateConnectionStatus(
                    isFromGoogleSheets, 
                    isFromGoogleSheets ? 'Terhubung ke Google Sheets' : 'Menggunakan data lokal'
                );
                
                // Setup filter dropdowns
                populateFilterDropdowns(allStudentsData);
                
                // Apply default filters
                filteredStudentsData = [...allStudentsData];
                applyFilters();
                
                // Setup tabs
                setupTabs();
                
                // Load Chart.js
                loadChartJS();
                
                // Sembunyikan loading
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                    document.getElementById('dashboard-content').style.display = 'block';
                }, 500);
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading-overlay').style.display = 'none';
                showError(`Gagal memuat data: ${error.message}`);
                updateConnectionStatus(false, 'Gagal menghubungkan');
            }
        }

        // Global function untuk dipanggil dari HTML
        window.selectStudentFromClass = selectStudentFromClass;
        window.retryLoad = function() {
            loadData();
        };

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // Auto-refresh setiap 5 menit
            setInterval(() => {
                if (isOnline) {
                    console.log('Auto-refresh data...');
                    loadData();
                }
            }, 300000);
        });
    </script>
</body>
</html>
